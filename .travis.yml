language: java

jobs:
  include:
  - stage: build
    script:
    - mvn clean install -DskipTests -B
  - stage: unit-test
    services: mysql
    script: mvn test -B
  - stage: integration-test
    services: mysql
    script: mvn verify -DskipUTs=true -B
    
stages:
- build
- unit-test
- integration-test
- name: deploy
  if: branch IN (master, dev) AND type = push
  
addons:
  sonarcloud:
    organization: "etnoy"
    token:
      secure: "jGLY4xZLfM41eacsc1EIs9zva5asHcfkghFm4Gp/rHR5VmfLzooPO7amQ8Mckm4mrzUO7kss0bkF3mAFi2CVvJAXPMLv9PXfp5pJFRERtSeJxYBiF8o6WPQxThAMHPV6m4ts5z9/1u/fBWfOa0LTGxepJ+Zh9VuDTGDZ7oB+/Mbbtyxf1JQqIw+dbTX3X3Aqv4EZgQTDGpK9HH/a4etiOwSvcACgLJ1Blzh2EaTNHKMC48mmfs/Yo1whsV6ylkDt21qmQvUtAHwWnlw3tpx+0QptA09V4N8qpNNDopv8pdgPGJQa4XVedNhlQ1iQmZWrbRdfVA7h+ONg0/8uCX57+b6HztDK5pUjfqh3lFYoIeqDbSo5taUL7Gv4z8ruKu4PsN1Byz+H2gP40tPJMzZocKBJyMXiyMGhtX6wWpfYHywdP/QD2qTwY2g7y8aU9SDbWQEuVxns6sgm4K7BE8fOD0WtpjiYec1V1Ctl5GD8jHUukT3QcCNTiSMSTVXfhuTPUqGlE0Kd6gitAZx+WMvI5xs5uZIYsOoQYEn4jnb1S0APp5u5F8aRwGI9wFtKVHE7Xp0yF6hlT2gQObXkm7Obj17HexoMAKgf/hFjOMoKfyo3VDK9wGVy0EumXelZpCt/LjCTF82z+LObteu3fOydquwL1SwIBYLaW0Os8wmMbEg="
      
script:
  - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dsonar.projectKey=etnoy_SecurityShepherd
  - mvn clean verify sonar:sonar -Pcoverage