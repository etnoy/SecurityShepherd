language: java
dist: trusty
jobs:
  include:
  - stage: build
    script:
    - mvn clean install -DskipTests -B
  - stage: unit-test
    services: mysql
    script: mvn test -B
  - stage: integration-test
    services: mysql
    script: mvn verify -DskipUTs=true -B
stages:
- build
- unit-test
- integration-test
- name: deploy
  if: branch IN (master, dev) AND type = push
addons:
  sonarcloud:
    organization: etnoy
    token:
      secure: M9X/gT1m0GkWCmCek/2y4mj2ajxqNzsY9yzG5nGhJMNp4pRU2w5vFAvkrDfvu36dRiJKM1vzQJ4B70+nSKniQm5IIrf/Z2gSZTPMNQ+lvTR3d481CSMFUr+/S3IcPS9a9WYkd/galaElroBwyrNE1e53G4tSTSACXUBcCTE09eoMKQ/Zu2fEFH4UvWBkv4D0BDbG5OR0g+yKDdJ+9HTfOklnixVI1HFuLzGWBySm34KqBNM5TYFY8YR2240IDJGPwNmrZmwTpP6YS3IOHvPbNMe064D5j6Os2JYAlN38hldb0DykSR9dCUYp6QGys+CKOcxC1hkpCMPHKesl8HV3JifLKv9U9RY0JsLpknZLYFCUhSPmJARXvAuIrnzA2F/ps2Ix3MxwjqqWkBH4lWehBgj5IxJ4GdyxSa8/lty77YqMHinDVfx+bxYmhUjmTF70Or5ZI3mxieEAk2l5rnO5GaBf60d+NM+UAcl2DMg+2K9e4FdwxOtBeHSU6gspDGkbYK05qA4vP6fXdom1CLMNaZ3Ug9nodpH7DI0ZUa94xUaamz59QDW5BPa9DP1OopTiQH5Pe/EI3tl2PxlbqhWvNq19Wn8pZvztlbAg1+XGxM4QuSnNn7g8XUSjyQ1ELVcJWNEMUsjrJ7v07QMaf5LYaFXzSkcuK98pPLZhTcH/U40=
script:
- mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dsonar.projectKey=etnoy_SecurityShepherd